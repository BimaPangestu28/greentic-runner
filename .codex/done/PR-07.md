# PR-07.md (greentic-runner or flow execution repo)
# Title: Provider runtime plumbing (registry + provider-core invocation node)

## Goal
Add full runtime support to invoke providers via provider-core:
- resolve provider runtime component from pack/provider extension
- wire host imports
- call provider-core `invoke(op, input_json)`
- map outputs to state/payload

## Tasks
1. **ProviderRegistry**
   - Add a registry that can resolve:
     - provider instance id OR provider_type â†’ (pack ref, component ref, export, config location)
   - Registry sources:
     - installed providers state/config store
     - pack manifest provider extension data
2. **Execution step / Node**
   - Implement `ProviderInvoke` step (or node kind) that takes:
     - `provider_id` or `provider_type`
     - `op`
     - `input` mapping (from payload/state to JSON input)
     - `output` mapping (from JSON output to payload/state)
     - `error` mapping (optional)
   - Reuse your existing mapper system (`in_map/out_map/err_map`) patterns.
3. **Wasmtime instantiation**
   - Instantiate component implementing `greentic:provider/schema-core@1.0.0`
   - Wire imports: state-store, secrets-store, http, telemetry, logging
4. **Error handling**
   - Normalize provider errors into your `Outcome`/`NodeError` model
5. **Tests**
   - Unit tests around registry resolution
   - Wasmtime-based integration test with `provider-core-dummy` component:
     - invoke echo
     - verify mappings

## Acceptance criteria
- Runner can invoke provider-core components deterministically.
- No legacy typed provider worlds needed for this path.
