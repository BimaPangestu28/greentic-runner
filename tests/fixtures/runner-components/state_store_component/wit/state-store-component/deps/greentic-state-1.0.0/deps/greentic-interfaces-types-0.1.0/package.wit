// SPDX-License-Identifier: MIT
package greentic:interfaces-types@0.1.0;

interface types {
  type env-id = string;
  type tenant-id = string;
  type team-id = string;
  type user-id = string;
  type state-key = string;
  type session-key = string;

  record impersonation {
    actor-id: user-id,
    reason: option<string>,
  }

  record tenant-ctx {
    env: env-id,
    tenant: tenant-id,
    tenant-id: tenant-id,
    team: option<team-id>,
    team-id: option<team-id>,
    user: option<user-id>,
    user-id: option<user-id>,
    trace-id: option<string>,
    correlation-id: option<string>,
    attributes: list<tuple<string, string>>,
    session-id: option<string>,
    flow-id: option<string>,
    node-id: option<string>,
    provider-id: option<string>,
    deadline-ms: option<s64>,
    attempt: u32,
    idempotency-key: option<string>,
    impersonation: option<impersonation>,
  }

  record session-cursor {
    node-pointer: string,
    wait-reason: option<string>,
    outbox-marker: option<string>,
  }

  enum error-code {
    unknown,
    invalid-input,
    not-found,
    conflict,
    timeout,
    unauthenticated,
    permission-denied,
    rate-limited,
    unavailable,
    internal,
  }

  record outcome-pending {
    reason: string,
    expected-input: option<list<string>>,
  }

  record outcome-error {
    code: error-code,
    message: string,
  }

  variant outcome {
    done(string),
    pending(outcome-pending),
    error(outcome-error),
  }

  variant protocol {
    http,
    https,
    tcp,
    udp,
    grpc,
    custom(string),
  }

  record allow-list {
    domains: list<string>,
    ports: list<u16>,
    protocols: list<protocol>,
  }

  record network-policy {
    egress: allow-list,
    deny-on-miss: bool,
  }

  variant signature-algorithm {
    ed25519,
    other(string),
  }

  record signature {
    key-id: string,
    algorithm: signature-algorithm,
    signature: list<u8>,
  }

  record pack-ref {
    oci-url: string,
    version: string,
    digest: string,
    signatures: list<signature>,
  }

  record span-context {
    tenant: tenant-id,
    session-id: option<session-key>,
    flow-id: string,
    node-id: option<string>,
    provider: string,
    start-ms: option<s64>,
    end-ms: option<s64>,
  }
}
